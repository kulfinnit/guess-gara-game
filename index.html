<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Guess Gara - By Kulfi</title>
        <link rel="icon" type="image/x-icon" href="favicon.ico" />
        <link rel="manifest" href="manifest.json" />
        <meta name="theme-color" content="#ff005a" />
        <link
            href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap"
            rel="stylesheet"
        />
        <style>
            :root {
                --bg-light: #f4f4f4;
                --text-light: #1a1a1a;
                --bg-dark: #1a1a1a;
                --text-dark: #f4f4f4;
                --accent: #ff005a;
                --pixel-border: 4px solid #000;
            }

            body {
                font-family: "Press Start 2P", cursive;
                background-color: var(--bg-light);
                color: var(--text-light);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                min-height: 100vh;
                padding: 20px;
                transition:
                    background-color 0.5s,
                    color 0.5s;
                position: relative;
                overflow-x: hidden;
            }

            .splash {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: #000;
                color: #0f0;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 20px;
                z-index: 9999;
            }

            .splash.hide {
                animation: fadeOut 1s forwards;
            }

            @keyframes fadeOut {
                to {
                    opacity: 0;
                    visibility: hidden;
                }
            }

            .dark-mode {
                background-color: var(--bg-dark);
                color: var(--text-dark);
            }

            .container {
                border: var(--pixel-border);
                padding: 20px;
                max-width: 600px;
                width: 90%;
                text-align: center;
                background-color: inherit;
            }

            input[type="number"],
            select {
                padding: 10px;
                font-size: 16px;
                margin: 10px;
                font-family: "Press Start 2P";
                width: 90%;
            }

            button {
                padding: 10px 20px;
                font-family: "Press Start 2P";
                background-color: var(--accent);
                color: #fff;
                border: none;
                margin: 10px 5px;
                cursor: pointer;
            }

            button:hover {
                transform: scale(1.1);
            }
            button.forget {
                background-color: maroon;
                color: #fff;
            }

            .shake {
                animation: shake 0.4s;
            }

            @keyframes shake {
                0%,
                100% {
                    transform: translateX(0);
                }
                25% {
                    transform: translateX(-5px);
                }
                50% {
                    transform: translateX(5px);
                }
                75% {
                    transform: translateX(-5px);
                }
            }

            .particle {
                position: absolute;
                width: 8px;
                height: 8px;
                background-color: var(--accent);
                animation: explode 1s ease-out;
                z-index: 10000;
            }

            @keyframes explode {
                0% {
                    opacity: 1;
                    transform: scale(1);
                }
                100% {
                    opacity: 0;
                    transform: scale(2);
                }
            }
        </style>
    </head>
    <body>
        <!-- Splash screen -->
        <div class="splash" id="splashScreen">‚ö° Loading Up Numbers...</div>

        <!-- Main game container -->
        <div class="container" style="display: none" id="mainGame">
            <h1>Beat All levels for 10% Off</h1>
            <p id="narrator">On my services of course</p>

            <label for="difficulty">Difficulty:</label>
            <select id="difficulty" onchange="setDifficulty()">
                <option value="easy">Easy (1-50, 18 turns)</option>
                <option value="medium" selected>
                    Medium (1-100, 15 turns)
                </option>
                <option value="hard">Hard (1-200, 12 turns)</option>
                <option value="Extreme">Extreme (1-500, 10 turns)</option>
                <option value="Hell">Hell (1-1000, 9 turns)</option>
                <option value="Extra Cold Kulfi">
                    Extra Cold Kulfi (1-1500, 7 turns)
                </option>
                <option value="double or nothing">
                    Double or Nothing for 20%
                </option>
            </select>
            <br />

            <label>Enter a number:</label><br />
            <input type="number" id="guessInput" /><br />

            <button onclick="checkGuess()">GUESS</button>
            <button onclick="resetGame()">RESET</button>
            <button onclick="toggleMode()">DARK MODE</button>
            <button onclick="togglePlayer()">TOGGLE PLAYER</button>
            <button class="forget" onclick="clearData()">FORGET</button>
            <button id="installBtn" style="display: none">INSTALL APP</button>

            <p id="feedback"></p>
            <p id="scoreDisplay">High Score: 0</p>
            <p id="turnDisplay"></p>
            <p id="playerDisplay">Player: 1</p>
            <p id="leaderboardTitle">üèÜ Leaderboard</p>
            <ol id="leaderboard"></ol>
        </div>

        <!-- Sounds -->
        <audio
            id="correctSound"
            src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"
        ></audio>
        <audio
            id="wrongSound"
            src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"
        ></audio>
        <audio
            id="gameOverSound"
            src="https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg"
        ></audio>

        <!-- Footer -->
        <footer
            style="
                text-align: center;
                margin-top: 30px;
                font-size: 14px;
                color: #ff005a;
            "
        >
            Kabiraj
        </footer>

        <!-- Game Script -->
        <script>
            let secret = 0;
            let max = 100;
            let turns = 12;
            let maxTurns = 12;
            let isDark = false;
            let highScore = localStorage.getItem("highScore") || 0;
            let currentPlayer = 1;
            let leaderboard =
                JSON.parse(localStorage.getItem("leaderboard")) || [];

            const narrator = document.getElementById("narrator");
            const feedback = document.getElementById("feedback");
            const correctSound = document.getElementById("correctSound");
            const wrongSound = document.getElementById("wrongSound");
            const gameOverSound = document.getElementById("gameOverSound");
            const scoreDisplay = document.getElementById("scoreDisplay");
            const turnDisplay = document.getElementById("turnDisplay");
            const playerDisplay = document.getElementById("playerDisplay");
            const leaderboardDisplay = document.getElementById("leaderboard");
            const guessInput = document.getElementById("guessInput");

            window.addEventListener("load", () => {
                const splash = document.getElementById("splashScreen");
                const main = document.getElementById("mainGame");

                setTimeout(() => {
                    splash.classList.add("hide");
                    main.style.display = "block";
                    setTimeout(() => splash.remove(), 1000);
                }, 1500);

                // Allow Enter key to trigger guess
                guessInput.addEventListener("keydown", function (event) {
                    if (event.key === "Enter" || event.keyCode === 13) {
                        checkGuess();
                    }
                });

                // Initialize
                scoreDisplay.innerText = `High Score: ${highScore}`;
                setDifficulty();
                renderLeaderboard();
            });

            function setDifficulty() {
                const difficulty = document.getElementById("difficulty").value;
                if (difficulty === "easy") {
                    max = 50;
                    maxTurns = 18;
                } else if (difficulty === "medium") {
                    max = 100;
                    maxTurns = 15;
                } else if (difficulty === "Extra Cold Kulfi") {
                    max = 1500;
                    maxTurns = 7;
                } else if (difficulty === "Extreme") {
                    max = 500;
                    maxTurns = 10;
                } else if (difficulty === "Hell") {
                    max = 1000;
                    maxTurns = 9;
                } else if (difficulty === "double or nothing") {
                    max = 2000;
                    maxTurns = 6;
                } else {
                    max = 200;
                    maxTurns = 12;
                }
                resetGame();
            }

            function checkGuess() {
                const guess = parseInt(guessInput.value);
                if (isNaN(guess)) {
                    narrator.innerText = "Number please!";
                    return;
                }

                if (turns <= 0) {
                    const difficulty =
                        document.getElementById("difficulty").value;
                    if (difficulty === "double or nothing") {
                        narrator.innerText = "Reset again! You lost!";
                    } else {
                        narrator.innerText = "Haha! Reset to try again.";
                    }

                    return;
                }

                if (guess === secret) {
                    feedback.innerText = `You guessed it! The number was ${secret}!`;
                    const difficulty =
                        document.getElementById("difficulty").value;
                    if (difficulty === "double or nothing") {
                        narrator.innerText =
                            "Congratulations! You just won 20% discount!";
                    } else {
                        narrator.innerText = "Winner winner kulfi dinner! üç°";
                    }
                    correctSound.play();
                    updateHighScore();
                    updateLeaderboard(currentPlayer, turns);
                    launchParticles();
                } else {
                    turns--;
                    feedback.classList.add("shake");
                    setTimeout(() => feedback.classList.remove("shake"), 400);
                    feedback.innerText =
                        guess < secret
                            ? "Too low! Aim higher!"
                            : "Too high! Chill down!";
                    narrator.innerText = `Turns left: ${turns}`;
                    wrongSound.play();

                    if (turns === 0) {
                        const difficulty =
                            document.getElementById("difficulty").value;
                        if (difficulty === "double or nothing") {
                            narrator.innerText = `Haha almost!, the number was ${secret}.`;
                        } else {
                            narrator.innerText = `Try again! The number was ${secret}.`;
                        }
                        gameOverSound.play();
                    }
                }

                turnDisplay.innerText = `Turns Remaining: ${turns}`;
            }

            function resetGame() {
                secret = Math.floor(Math.random() * max) + 1;
                turns = maxTurns;
                guessInput.value = "";
                feedback.innerText = "";
                narrator.innerText = `Guess a number between 1 and ${max}. You have ${turns} turns.`;
                turnDisplay.innerText = `Turns Remaining: ${turns}`;
            }
            function clearData() {
                if (confirm("Are you sure you want to forget everything?")) {
                    localStorage.clear();
                    location.reload();
                }
            }

            function toggleMode() {
                document.body.classList.toggle("dark-mode");
                isDark = !isDark;
            }

            function togglePlayer() {
                currentPlayer = currentPlayer === 1 ? 2 : 1;
                playerDisplay.innerText = `Player${currentPlayer}`;
                resetGame();
            }

            function updateHighScore() {
                if (turns > highScore) {
                    highScore = turns;
                    localStorage.setItem("highScore", highScore);
                    scoreDisplay.innerText = `High Score: ${highScore}`;
                }
            }

            function updateLeaderboard(player, score) {
                leaderboard.push({ player: player, score: score });
                leaderboard.sort((a, b) => b.score - a.score);
                leaderboard = leaderboard.slice(0, 3);
                localStorage.setItem(
                    "leaderboard",
                    JSON.stringify(leaderboard),
                );
                renderLeaderboard();
            }

            function renderLeaderboard() {
                leaderboardDisplay.innerHTML = "";
                leaderboard.forEach((entry, index) => {
                    const li = document.createElement("li");
                    li.textContent = `Player${entry.player}: ${entry.score}`;
                    leaderboardDisplay.appendChild(li);
                });
            }

            function launchParticles() {
                for (let i = 0; i < 20; i++) {
                    const particle = document.createElement("div");
                    particle.classList.add("particle");
                    particle.style.left =
                        Math.random() * window.innerWidth + "px";
                    particle.style.top =
                        Math.random() * window.innerHeight + "px";
                    document.body.appendChild(particle);
                    setTimeout(() => particle.remove(), 1000);
                }
            }
            let deferredPrompt;
            const installBtn = document.getElementById("installBtn");

            window.addEventListener("beforeinstallprompt", (e) => {
                e.preventDefault();
                deferredPrompt = e;

                // Show the install button
                installBtn.style.display = "inline-block";

                installBtn.addEventListener("click", () => {
                    installBtn.style.display = "none"; // Hide after click
                    deferredPrompt.prompt();

                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === "accepted") {
                            console.log("User accepted the install prompt");
                        } else {
                            console.log("User dismissed the install prompt");
                        }
                        deferredPrompt = null;
                    });
                });
            });

            if ("serviceWorker" in navigator) {
                window.addEventListener("load", () => {
                    navigator.serviceWorker.register("sw.js").then(
                        (reg) => console.log("Service worker registered.", reg),
                        (err) =>
                            console.log(
                                "Service worker registration failed:",
                                err,
                            ),
                    );
                });
            }
        </script>
    </body>
</html>
